server {
    listen 80;
    listen [::]:80 ipv6only=on;

    server_tokens off;

    if ( $host = "ebelleon.de" ) {
        return 301 $scheme://www.$host$request_uri;
    }

    # remove extension from url
    rewrite ^(/.*)\.html(\?.*)?$ $1$2 permanent;
    # add trailing slash
    rewrite ^([^.]*[^/])$ $1/ permanent;
    rewrite ^(.*)/$ /$1 break;

    root /var/www/html;
    index index.html;

    location = /robots.txt {
      allow all;
      log_not_found off;
      access_log off;
    }

    gzip on;
    gzip_vary on;
    gzip_comp_level 4;
    gzip_min_length 256;
    gzip_types
      application/javascript
      application/x-javascript
      application/json
      application/x-font-ttf
      application/x-font-woff
      application/rss+xml
      font/opentype
      image/svg+xml
      image/png
      image/jpeg
      image/x-icon
      text/javascript
      text/cache-manifest
      text/css
      text/xml
      text/plain
      text/x-component
      text/x-cross-domain-policy;

    # Force all paths to load either itself (js files) or go through index.html.
    location / {
        try_files $uri/index.html $uri.html $uri/ $uri =404;

        # error_page 404 /404.htm;
        # error_page 500 502 503 504 /500.htm;
    }

    location ~* \.(js|css|png|jpg|jpeg|svg|woff2|gif|ico)$ {
        expires 30d;
        add_header Cache-Control "public, no-transform";
    }

}

